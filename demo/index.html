<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>post-messenger - parent</title>
  <style>
    iframe, pre {
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="root">
    <pre id="list"></pre>
    <iframe id="iframe" name="iframe_name" src="./iframe.html"></iframe>
    <div>
      <input type="button" value="Once" onclick="javascript: onceListener()" />
      <input type="button" value="On" onclick="javascript: onListener()" />
      <input type="button" value="Off" onclick="javascript: offListener()" />
      <input type="button" value="Send" onclick="javascript: sendMessage()" />
    </div>
  </div>
<script src="../lib/post-messenger.min.js" type="application/javascript"></script>
<script type="application/javascript">
  var messenger = new PostMessenger('uniqueId', '#iframe');

  function listener(message) {
    const r = document.querySelector('#list');
    console.log(message);
    r.innerHTML = r.innerHTML + '\n' + message;
  }

  function onceListener() {
    messenger.once('iframe.*', listener);
  }

  function onListener() {
    messenger.on('iframe.*', listener);
  }

  function offListener() {
    messenger.off('iframe.*', listener);
  }

  function sendMessage() {
    messenger.send('iframe.data', new Date() + ', Hello world.');
  }
</script>
</body>
</html>