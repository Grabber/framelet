!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).Framelet=n()}(this,(function(){"use strict";var e=function(){return"undefined"!=typeof window&&!!window.postMessage},n=function(e,n){if(!e)throw new Error(n)};var t=function(e){n("string"==typeof e,"`namespace` must be a string")},o=function(e,n){t(e);var o=Object.assign({sep:".",wil:"*"},n);return{match:function(n){return t(n),function e(n,t,o){var r=t[0],i=t.slice(1),s=n[0],a=n.slice(1),u=o.wil;return(r===s||-1!==[r,s].indexOf(u))&&(0===i.length&&0===a.length?r===s||-1!==[r,s].indexOf(u):0===i.length?r===u:0===a.length?s===u:e(a,i,o))}(e.split(o.sep),n.split(o.sep),o)}}};if("production"!==process.env.NODE_ENV){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID. If you use Expo, install `expo-random` and use `nanoid/async`.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Add `if (!window.crypto) window.crypto = window.msCrypto` before Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.")}return function(t,r){void 0===r&&(r="*");var i=[],s=null,a=((e=21)=>{let n="",t=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let o=63&t[e];n+=o<36?o.toString(36):o<62?(o-26).toString(36).toUpperCase():o<63?"_":"-"}return n})(),u=function(){0===i.length&&s&&(!function(n){e()&&window.removeEventListener("message",n,!1)}(s),s=null)},c=function(){return function(e){var n=function(e){var n={};try{n=JSON.parse(e)}catch(e){}return n}(e.data),t=n.topic,r=n.message;if(n.signature===a){for(var s=0;s<i.length;s+=1){var c=i[s],f=c.topic,d=c.cb,p=c.once;o(f).match(t)&&(p&&(i.splice(s,1),s-=1),d(r,e))}u()}}},f=function(n,t,o){void 0===o&&(o=!1),0===i.length&&function(n){e()&&window.addEventListener("message",n,!1)}(s=c()),i.push({topic:n,cb:t,once:o})};return{channels:i,listener:listener,off:function(e,n){if(void 0===e&&void 0===n)i=[];else for(var t=0;t<i.length;t+=1){var o=i[t],r=o.topic,s=o.cb;r===e&&s===n&&(i.splice(t,1),t-=1)}u()},on:f,once:function(e,n){f(e,n,!0)},send:function(e,o){n(t&&t.postMessage,"`target` can't call `postMessage` function"),t.postMessage(function(e,n){return JSON.stringify({topic:e,message:n,signature:a})}(e,o),r)}}}}));
