!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).Framelet=e()}(this,(function(){"use strict";var n=function(n){if("string"!=typeof n)throw new Error("`namespace` must be a string")},e=function(e,t){n(e);var o=Object.assign({sep:".",wil:"*"},t);return{match:function(t){return n(t),function n(e,t,o){var i=e[0],r=t[0],s=e.slice(1),c=t.slice(1),f=o.wil;return(r===i||-1!==[r,i].indexOf(f))&&(0===c.length&&0===s.length?r===i||-1!==[r,i].indexOf(f):0===c.length?r===f:0===s.length?i===f:n(s,c,o))}(e.split(o.sep),t.split(o.sep),o)}}},t=function(){return"undefined"!=typeof window&&!!window.postMessage};return function(n,o,i){void 0===i&&(i="*");var r=[],s=null,c=function(e,t){return JSON.stringify({topic:e,message:t,context:n})},f=function(){0===r.length&&s&&(s=function(n){return t()&&window.removeEventListener("message",n,!1),null}(s))},u=function(){return function(t){var o=function(n){var e={};try{e=JSON.parse(n)}catch(n){}return e}(t.data),i=o.topic,s=o.message;if(o.context===n){for(var c=0;c<r.length;c+=1){var u=r[c],a=u.topic,l=u.cb,p=u.once;e(a).match(i)&&(p&&(r.splice(c,1),c-=1),l(s,t))}f()}}},a=function(n,e,o){void 0===o&&(o=!1),0===r.length&&function(n){t()&&window.addEventListener("message",n,!1)}(s=u()),r.push({topic:n,cb:e,once:o})};return{off:function(n,e){if(void 0===n&&void 0===e)r=[];else for(var t=0;t<r.length;t+=1){var o=r[t],i=o.topic,s=o.cb;i===n&&s===e&&(r.splice(t,1),t-=1)}f()},on:a,once:function(n,e){a(n,e,!0)},send:function(n,e){for(var t=0;t<o.length;t++){if(!o[t]||!o[t].postMessage)throw new Error("can't post message");o[t].postMessage(c(n,e),i)}}}}}));
