!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).Framelet=e()}(this,(function(){"use strict";var n=function(){return"undefined"!=typeof window&&!!window.postMessage},e=function(n,e){if(!n)throw new Error(e)};var t=function(n){e("string"==typeof n,"`namespace` must be a string")},i=function(n,e){t(n);var i=Object.assign({sep:".",wil:"*"},e);return{match:function(e){return t(e),function n(e,t,i){var o=e[0],r=t[0],s=e.slice(1),c=t.slice(1),f=i.wil;return(r===o||-1!==[r,o].indexOf(f))&&(0===c.length&&0===s.length?r===o||-1!==[r,o].indexOf(f):0===c.length?r===f:0===s.length?o===f:n(s,c,i))}(n.split(i.sep),e.split(i.sep),i)}}};return function(t,o,r){void 0===r&&(r="*");var s=[],c=null,f=function(){0===s.length&&c&&(c=function(e){return n()&&window.removeEventListener("message",e,!1),null}(c))},u=function(){return function(n){var e=function(n){var e={};try{e=JSON.parse(n)}catch(n){}return e}(n.data),o=e.topic,r=e.message;if(e.context===t){for(var c=0;c<s.length;c+=1){var u=s[c],a=u.topic,l=u.cb,p=u.once;i(a).match(o)&&(p&&(s.splice(c,1),c-=1),l(r,n))}f()}}},a=function(e,t,i){void 0===i&&(i=!1),0===s.length&&function(e){n()&&window.addEventListener("message",e,!1)}(c=u()),s.push({topic:e,cb:t,once:i})};return{off:function(n,e){if(void 0===n&&void 0===e)s=[];else for(var t=0;t<s.length;t+=1){var i=s[t],o=i.topic,r=i.cb;o===n&&r===e&&(s.splice(t,1),t-=1)}f()},on:a,once:function(n,e){a(n,e,!0)},send:function(n,i){e(o&&o.postMessage,"`postMessage` isn't available"),o.postMessage(function(n,e){return JSON.stringify({topic:n,message:e,context:t})}(n,i),r)}}}}));
