!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).Framelet=e()}(this,(function(){"use strict";var n=function(){return"undefined"!=typeof window&&!!window.postMessage},e=function(n,e){if(!n)throw new Error(e)};var t=function(n){e("string"==typeof n,"`namespace` must be a string")},o=function(n,e){t(n);var o=Object.assign({sep:".",wil:"*"},e);return{match:function(e){return t(e),function n(e,t,o){var i=t[0],c=t.slice(1),r=e[0],s=e.slice(1),f=o.wil;return(i===r||-1!==[i,r].indexOf(f))&&(0===c.length&&0===s.length?i===r||-1!==[i,r].indexOf(f):0===c.length?i===f:0===s.length?r===f:n(s,c,o))}(n.split(o.sep),e.split(o.sep),o)}}};return function(t,i,c){void 0===c&&(c="*");var r=[],s=null,f=function(){0===r.length&&s&&(!function(e){n()&&window.removeEventListener("message",e,!1)}(s),s=null)},u=function(){return function(n){var e=function(n){console.log(1),console.log(n),console.log(2);var e={};try{e=JSON.parse(n)}catch(n){}return e}(n.data),i=e.topic,c=e.message;if(e.project===t){for(var s=0;s<r.length;s+=1){var u=r[s],a=u.ch,l=u.cb,p=u.once;o(a).match(i)&&(p&&(r.splice(s,1),s-=1),l(c,n))}f()}}},a=function(e,t,o){void 0===o&&(o=!1),0===r.length&&function(e){n()&&window.addEventListener("message",e,!1)}(s=u()),r.push({ch:e,cb:t,once:o})};return{channels:r,listener:function(){return s},off:function(n,e){if(void 0===n&&void 0===e)r=[];else for(var t=0;t<r.length;t+=1){var o=r[t],i=o.ch,c=o.cb;i===n&&c===e&&(r.splice(t,1),t-=1)}f()},on:a,once:function(n,e){a(n,e,!0)},send:function(n,o){e(i&&i.postMessage,"`target` can't call `postMessage` function"),i.postMessage(function(n,e){return JSON.stringify({topic:n,message:e,project:t})}(n,o),c)}}}}));
