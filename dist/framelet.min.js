!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).Framelet=e()}(this,(function(){"use strict";var n=function(n){if("string"!=typeof n)throw new Error("`namespace` must be a string")},e=function(e,t){n(e);var i=Object.assign({sep:".",wil:"*"},t);return{match:function(t){return n(t),function n(e,t,i){var o=e[0],r=t[0],s=e.slice(1),c=t.slice(1),f=i.wil;return(r===o||-1!==[r,o].indexOf(f))&&(0===c.length&&0===s.length?r===o||-1!==[r,o].indexOf(f):0===c.length?r===f:0===s.length?o===f:n(s,c,i))}(e.split(i.sep),t.split(i.sep),i)}}},t=function(){return"undefined"!=typeof window&&!!window.postMessage};return function(n,i,o){void 0===o&&(o="*");var r=[],s=null,c=function(){0===r.length&&s&&(s=function(n){return t()&&window.removeEventListener("message",n,!1),null}(s))},f=function(){return function(t){var i=function(n){var e={};try{e=JSON.parse(n)}catch(n){}return e}(t.data),o=i.topic,s=i.message;if(i.context===n){for(var f=0;f<r.length;f+=1){var u=r[f],a=u.topic,p=u.cb,l=u.once;e(a).match(o)&&(l&&(r.splice(f,1),f-=1),p(s,t))}c()}}},u=function(n,e,i){void 0===i&&(i=!1),0===r.length&&function(n){t()&&window.addEventListener("message",n,!1)}(s=f()),r.push({topic:n,cb:e,once:i})};return{off:function(n,e){if(void 0===n&&void 0===e)r=[];else for(var t=0;t<r.length;t+=1){var i=r[t],o=i.topic,s=i.cb;o===n&&s===e&&(r.splice(t,1),t-=1)}c()},on:u,once:function(n,e){u(n,e,!0)},send:function(e,t){if(!i&&!i.postMessage)throw new Error("can't post message");i.postMessage(function(e,t){return JSON.stringify({topic:e,message:t,context:n})}(e,t),o)}}}}));
