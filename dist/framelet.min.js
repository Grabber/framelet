!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).Framelet=n()}(this,(function(){"use strict";var e=function(){return"undefined"!=typeof window&&!!window.postMessage},n=function(e,n){if(!e)throw new Error(n)};var t=function(e){n("string"==typeof e,"`namespace` must be a string")},r=function(e,n){t(e);var r=Object.assign({sep:".",wil:"*"},n);return{match:function(n){return t(n),function e(n,t,r){var c=t[0],i=t.slice(1),o=n[0],s=n.slice(1),a=r.wil;return(c===o||-1!==[c,o].indexOf(a))&&(0===i.length&&0===s.length?c===o||-1!==[c,o].indexOf(a):0===i.length?c===a:0===s.length?o===a:e(s,i,r))}(e.split(r.sep),n.split(r.sep),r)}}};return new(function(){function t(e,n,t){}var c=t.prototype;return c.encode=function(e,n){return JSON.stringify({topic:e,message:n,project:project})},c.decode=function(e){var n={};try{n=JSON.parse(e)}catch(e){}return n},c.check=function(){var n;0===channels.length&&event_listener&&(n=event_listener,e()&&window.removeEventListener("message",n,!1),event_listener=null)},c.listenerEntry=function(){return function(e){var n=decode(e.data),t=n.topic,c=n.message;if(n.project===project){for(var i=0;i<channels.length;i+=1){var o=channels[i],s=o.ch,a=o.cb,f=o.once;r(s).match(t)&&(f&&(channels.splice(i,1),i-=1),a(c,e))}check()}}},c.on=function(n,t,r){var c;void 0===r&&(r=!1),0===channels.length&&(event_listener=listenerEntry(),c=event_listener,e()&&window.addEventListener("message",c,!1)),channels.push({ch:n,cb:t,once:r})},c.once=function(e,n){on(e,n,!0)},c.off=function(e,n){if(void 0===e&&void 0===n)channels=[];else for(var t=0;t<channels.length;t+=1){var r=channels[t],c=r.ch,i=r.cb;c===e&&i===n&&(channels.splice(t,1),t-=1)}check()},c.send=function(e,t){n(target&&target.postMessage,"`target` can't invoke `postMessage`"),target.postMessage(encode(e,t),origin)},c.listener=function(){return event_listener},t}())}));
