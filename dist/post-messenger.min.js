!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.PostMessenger=n()}(this,function(){"use strict";var e=function(e,n){for(var t=arguments.length,o=Array(t>2?t-2:0),s=2;s<t;s++)o[s-2]=arguments[s];if(!e){var i=0,r=n.replace(/%s/g,function(){return""+o[i++]}),c=new Error(r);throw c.name="Invariant",c.framesToPop=1,c}};var n=function(n){e("string"==typeof n,"namespace should be a string.")},t=function(e,t){n(e);var o=Object.assign({sep:".",wil:"*"},t);return{match:function(t){return n(t),function e(n,t,o){var s=t[0],i=t.slice(1),r=n[0],c=n.slice(1),a=o.wil;return(s===r||-1!==[s,r].indexOf(a))&&(0===i.length&&0===c.length?s===r||-1!==[s,r].indexOf(a):0===i.length?s===a:0===c.length?r===a:e(c,i,o))}(e.split(o.sep),t.split(o.sep),o)}}};return e(window.postMessage,"window.postMessage is not defined."),function(n,o){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*",i=null,r=[],c=function(){0===r.length&&i&&(function(e){window.removeEventListener("message",e,!1)}(i),i=null)},a=function(e,o){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];0===r.length&&function(e){window.addEventListener("message",e,!1)}(i=function(e){var o=function(e){return e}(e.data),s=o.channel,i=o.message;if(o.project===n){for(var a=0;a<r.length;a+=1){var f=r[a],u=f.ch,l=f.cb,g=f.once;t(u).match(s)&&(g&&(r.splice(a,1),a-=1),l(i,e))}c()}}),r.push({ch:e,cb:o,once:s})};return{getListener:function(){return i},channelListeners:r,on:a,once:function(e,n){a(e,n,!0)},off:function(e,n){if(void 0===e&&void 0===n)r=[];else for(var t=0;t<r.length;t+=1){var o=r[t],s=o.ch,i=o.cb;s===e&&i===n&&(r.splice(t,1),t-=1)}c()},send:function(t,i){e(o&&o.postMessage,"Messenger's target should has `postMessage` function."),o.postMessage(function(e,t){return{channel:e,message:t,project:n}}(t,i),s)}}}});
