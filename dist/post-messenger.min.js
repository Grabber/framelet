!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.PostMessenger=n()}(this,function(){"use strict";var e=function(e,n){for(var t=arguments.length,s=Array(t>2?t-2:0),i=2;i<t;i++)s[i-2]=arguments[i];if(!e){var r=0,o=n.replace(/%s/g,function(){return""+s[r++]}),a=new Error(o);throw a.name="Invariant",a.framesToPop=1,a}};var n=function(n){e("string"==typeof n,"namespace should be a string.")},t=function(e,t){n(e);var s=Object.assign({sep:".",wil:"*"},t);return{match:function(t){return n(t),function e(n,t,s){var i=t[0],r=t.slice(1),o=n[0],a=n.slice(1),c=s.wil;return(i===o||-1!==[i,o].indexOf(c))&&(0===r.length&&0===a.length?i===o||-1!==[i,o].indexOf(c):0===r.length?i===c:0===a.length?o===c:e(a,r,s))}(e.split(s.sep),t.split(s.sep),s)}}};module.exports=exports.default;var s=function(){function e(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(n,t,s){return t&&e(n.prototype,t),s&&e(n,s),n}}();var i=function(){function n(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*";!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),this.project=e,this.target=("string"==typeof t?document.querySelector(t):t)||{},this.target=(this.target.postMessage?this.target:this.target.contentWindow)||{},this.origin=s,this.listener=null,this.channelListeners=[]}return s(n,[{key:"once",value:function(e,n){this.on(e,n,!0)}},{key:"on",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];0===this.channelListeners.length&&(this.listener=this._listenerEntry(),function(e){window.addEventListener("message",e,!1)}(this.listener)),this.channelListeners.push({channel:e,listener:n,once:t})}},{key:"off",value:function(e,n){if(void 0===n&&void 0===e)this.channelListeners=[];else for(var t=0;t<this.channelListeners.length;t+=1){var s=this.channelListeners[t],i=s.channel,r=s.listener;i===e&&r===n&&(this.channelListeners.splice(t,1),t-=1)}this._check()}},{key:"send",value:function(n,t){e(this.target.postMessage,"Messenger's target should be a contentWindow."),this.target.postMessage(this._encode(n,t),this.origin)}},{key:"_check",value:function(){var e;0===this.channelListeners.length&&this.listener&&(e=this.listener,window.removeEventListener("message",e,!1),this.listener=null)}},{key:"_listenerEntry",value:function(){var e=this;return function(n){var s=e._decode(n.data),i=s.channel,r=s.message;if(s.project===e.project){for(var o=0;o<e.channelListeners.length;o+=1){var a=e.channelListeners[o],c=a.channel,l=a.listener,h=a.once;t(c).match(i)&&(h&&(e.channelListeners.splice(o,1),o-=1),l(r,n))}e._check()}}}},{key:"_encode",value:function(e,n){return{channel:e,message:n,project:this.project}}},{key:"_decode",value:function(e){return e}}]),n}();return module.exports=exports.default,e(window.postMessage,"window.postMessage is not defined."),module.exports=exports.default,i});
