!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.PostMessenger=e()}(this,function(){"use strict";var n=function(){return"undefined"!=typeof window&&!!window.postMessage},e=function(n,e){if(!n)throw new Error(e)};var t=function(n){e("string"==typeof n,"namespace should be a string.")},o=function(n,e){t(n);var o=Object.assign({sep:".",wil:"*"},e);return{match:function(e){return t(e),function n(e,t,o){var i=t[0],s=t.slice(1),r=e[0],c=e.slice(1),f=o.wil;return(i===r||-1!==[i,r].indexOf(f))&&(0===s.length&&0===c.length?i===r||-1!==[i,r].indexOf(f):0===s.length?i===f:0===c.length?r===f:n(c,s,o))}(n.split(o.sep),e.split(o.sep),o)}}};return function(t,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*",r=null,c=[],f=function(){0===c.length&&r&&(function(e){n()&&window.removeEventListener("message",e,!1)}(r),r=null)},u=function(e,i){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];0===c.length&&function(e){n()&&window.addEventListener("message",e,!1)}(r=function(n){var e=function(n){return n}(n.data),i=e.channel,s=e.message;if(e.project===t){for(var r=0;r<c.length;r+=1){var u=c[r],a=u.ch,l=u.cb,d=u.once;o(a).match(i)&&(d&&(c.splice(r,1),r-=1),l(s,n))}f()}}),c.push({ch:e,cb:i,once:s})};return{channelListeners:c,getListener:function(){return r},on:u,once:function(n,e){u(n,e,!0)},off:function(n,e){if(void 0===n&&void 0===e)c=[];else for(var t=0;t<c.length;t+=1){var o=c[t],i=o.ch,s=o.cb;i===n&&s===e&&(c.splice(t,1),t-=1)}f()},send:function(n,o){e(i&&i.postMessage,"Messenger's target should has `postMessage` function."),i.postMessage(function(n,e){return{channel:n,message:e,project:t}}(n,o),s)}}}});
