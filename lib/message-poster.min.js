!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("MessagePoster",[],n):"object"==typeof exports?exports.MessagePoster=n():e.MessagePoster=n()}("undefined"!=typeof self?self:this,function(){return function(e){function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var t={};return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=2)}([function(e,n,t){"use strict";function s(e){return Array.isArray(e)?e:Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0});n.invariant=function(e,n){for(var t=arguments.length,s=Array(t>2?t-2:0),r=2;r<t;r++)s[r-2]=arguments[r];if(!n)throw new Error("invariant requires an error message argument.");if(!e){var i=0,a=n.replace(/%s/g,function(){return""+s[i++]}),o=new Error(a);throw o.name="Invariant Violation",o.framesToPop=1,o}},n.messageEncode=function(e,n,t){return e+"-"+n+"-"+t},n.messageDecode=function(e){var n=e.split("-"),t=s(n);return{name:t[0],channel:t[1],message:t.slice(2).join("-")}},n.isChannelMatch=function(e,n){for(var t=e.split("."),s=e.split("."),r=0;r<t.length;r+=1)if(!["*",s[r]].includes(t[r]))return!1;return!0}},function(e,n,t){"use strict";function s(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});n.Target=function e(n){var t=this;s(this,e),this.addListener=function(e){t.listeners.push(e)},this.send=function(e){t.entity.postMessage(e,"*")},this.entity=n,this.listeners=[]}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Target=n.MessagePoster=void 0;var s=t(3);Object.defineProperty(n,"MessagePoster",{enumerable:!0,get:function(){return s.MessagePoster}});var r=t(1);Object.defineProperty(n,"Target",{enumerable:!0,get:function(){return r.Target}}),(0,t(0).invariant)(window.postMessage,"window.postMessage not defined.")},function(e,n,t){"use strict";function s(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.MessagePoster=void 0;var r=t(0),i=t(1),a=window.postMessage,o=(n.MessagePoster=function e(n){s(this,e),o.call(this),(0,r.invariant)(a,"window.postMessage not defined."),(0,r.invariant)(!n.includes("-"),"`name` can not contains '-'."),this.name=n,this.targets=[],this.listeners=[]},function(){var e=this;this._onMessage=function(n,t){return function(n){var s=(0,r.messageDecode)(n.data),i=s.name,a=s.channel,o=s.message;i===e.name&&(0,r.isChannelMatch)(e.ch,a)&&t(o)}},this.on=function(n,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*";(0,r.invariant)("function"==typeof t,"`cb` should be function."),(0,r.invariant)(n instanceof i.Target,"`target` should be instanceof Target.");var a=e._onMessage(s,t);window.addEventListener?(window.addEventListener("message",a,!1),n.addListener(a)):window.attachEvent&&(window.attachEvent("onmessage",a),n.addListener(a)),e.targets.push(n)},this.off=function(n){var t=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],e.targets.indexOf(n));if(-1!==t){e.targets.splice(t,1);e.listeners.splice(t,1);window.removeEventListener?window.removeEventListener("message",e.onMessage,!1):window.attachEvent&&window.attachEvent("onmessage",e.onMessage)}},this.clear=function(){},this.send=function(n,t,s){(0,r.invariant)("string"==typeof t&&t,"`channel` should be a string which can not be empty."),(0,r.invariant)(!t.includes("-"),"`channel` can not contains '-'."),(0,r.invariant)("string"==typeof s&&s,"`message` should be a string which can not be empty.");var i=(0,r.messageEncode)(e.name,t,s);n.send(i)},this.broadcast=function(n,t){e.targets.forEach(function(s){e.send(s,n,t)})}})}])});